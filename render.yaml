services:
  # Spring Boot API
  - name: medcheck-api
    type: web
    rootDir: medcheckapi
    plan: starter
    autoDeploy: true
    buildCommand: mvn -DskipTests package
    startCommand: >-
      java -Dserver.port=$PORT
           -Dspring.datasource.url=$SPRING_DATASOURCE_URL
           -Dspring.datasource.username=$SPRING_DATASOURCE_USERNAME
           -Dspring.datasource.password=$SPRING_DATASOURCE_PASSWORD
           -Dspring.sql.init.mode=never
           -Dapp.jwt-secret=$APP_JWT_SECRET
           -Dapp.reset.base-url=$APP_RESET_BASE_URL
           -jar target/*.jar
    envVars:
      - key: APP_JWT_SECRET
        generateValue: true
      - key: APP_RESET_BASE_URL
        fromService:
          name: medcheck-web
          type: web
          property: url
      - key: FRONTEND_ORIGINS
        fromService:
          name: medcheck-web
          type: web
          property: url
      # Preencha a seguir com as credenciais do seu banco MySQL (gerenciado no Render)
      - key: SPRING_DATASOURCE_URL
        value: jdbc:mysql://YOUR_MYSQL_HOST:3306/YOUR_DB?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=America/Rio_Branco
      - key: SPRING_DATASOURCE_USERNAME
        value: YOUR_DB_USER
      - key: SPRING_DATASOURCE_PASSWORD
        value: YOUR_DB_PASSWORD

  # Angular SSR Web (serving the app and proxying /api to the backend)
  - name: medcheck-web
    type: web
    rootDir: medcheckapp
    plan: starter
    autoDeploy: true
    buildCommand: npm ci && npm run build
    startCommand: node dist/medcheckapp/server/server.mjs
    envVars:
      - key: API_URL
        fromService:
          name: medcheck-api
          type: web
          property: url